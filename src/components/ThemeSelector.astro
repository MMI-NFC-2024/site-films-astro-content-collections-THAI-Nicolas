---
// src/components/ThemeSelector.astro
---

<div class="dropdown dropdown-end">
  <div tabindex="0" role="button" class="btn btn-ghost m-1">
    Thème
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-swatch-book-icon lucide-swatch-book"><path d="M11 17a4 4 0 0 1-8 0V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2Z"/><path d="M16.7 13H19a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H7"/><path d="M 7 17h.01"/><path d="m11 8 2.3-2.3a2.4 2.4 0 0 1 3.404.004L18.6 7.6a2.4 2.4 0 0 1 .026 3.434L9.9 19.8"/></svg>
  </div>

  <ul tabindex="0" class="dropdown-content menu bg-base-200 rounded-box z-[1] w-52 p-2 shadow-2xl mt-4 border border-base-300">
    <li>
      <input 
        type="radio" 
        name="theme-dropdown" 
        class="theme-controller btn btn-sm btn-block btn-ghost justify-start" 
        aria-label="Clair" 
        value="light" 
      />
    </li>
    <li>
      <input 
        type="radio" 
        name="theme-dropdown" 
        class="theme-controller btn btn-sm btn-block btn-ghost justify-start" 
        aria-label="Sombre" 
        value="dark" 
      />
    </li>
    <li>
      <input 
        type="radio" 
        name="theme-dropdown" 
        class="theme-controller btn btn-sm btn-block btn-ghost justify-start" 
        aria-label="Dracula" 
        value="dracula" 
      />
    </li>
  </ul>
</div>

<script>
  // On attend que le DOM soit chargé
  const themeInputs = document.querySelectorAll('.theme-controller');

  // Au clic sur un bouton radio
  themeInputs.forEach((input) => {
    input.addEventListener('change', (e) => {
      const target = e.target as HTMLInputElement;
      const theme = target.value;
      
      // 1. Appliquer le thème sur <html>
      document.documentElement.setAttribute('data-theme', theme);
      
      // 2. Sauvegarder dans le localStorage
      localStorage.setItem('theme', theme);
    });
  });

  // Pour cocher le bon bouton radio au chargement de la page
  const currentTheme = localStorage.getItem('theme') || 'light';
  const activeInput = document.querySelector(`.theme-controller[value="${currentTheme}"]`) as HTMLInputElement;
  if (activeInput) activeInput.checked = true;
</script>